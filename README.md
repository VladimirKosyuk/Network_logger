# Network_logger
Collects array from all domain servers with network logged information from each one

Описание: 

  Собирает список серверов домена;
  
  На каждом из списка через invoke-command запускает логирование по провайдеру Microsoft-Windows-TCPIP, вывод в *.etl в корень С:;
  
  Ожидает 12 часов (рекомендую не более 12 часов);
  
  На каждом из списка через invoke-command останавливает логирование, собирает список запущенных процессов в *.CSV файл в корне С:;
  
  На каждом из списка через SMB перемещает данные логирования и список процессов на шару;
  
  Парсинг событий для приведения к итоговому виду: Count – количество повторений, Name - ID процесса(может быть пустым)";"Имя процесса(может быть пустым)";local=ip:порт remote=ip:порт.

Требования к выполнению:

  Запуск от АДМ у\з на всех собираемых серверах;
  Execution policy unrestricted;
  Сервера из списка не ниже 2012 R2;
  Invoke-command с сервера источника на сервера назначения выполняется успешно;
  SMB шара для raw data с серверов должна быть доступна для серверов из списка;
  Все папки для сбора данных должны быть созданы до начала выполнения скрипта(создавать директории он не умеет);
  На каждом из серверов на диске С: должно быть не менее 7 ГБ свободного места.

Баги:

  Operation cannot be carried out because an object already exists. - возникает на шаге создания сессии логирования;
  No MSFT_NetEventSession objects found with property 'Name' equal to $myFQDN" - если воспроизводится ошибка выше;
  Если у сервера =>2 ip - в папке result появляется пустой файл с выводом. Причина - скрипт не умеет работать с таким;
  Set-NetEventSession -MaxFileSize - увеличение параметра более 6ГБ вызывает ошибку.
