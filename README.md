# Network_logger
Collects array from all domain servers with network logged information from each one

Описание: 

  1. Собирает список серверов домена;
  
  2. На каждом из списка через invoke-command запускает логирование по провайдеру Microsoft-Windows-TCPIP, вывод в *.etl в корень С:;
  
  3. Ожидает 12 часов (рекомендую не более 12 часов);
  
  4. На каждом из списка через invoke-command останавливает логирование, собирает список запущенных процессов в *.CSV файл в корне С:;
  
  5. На каждом из списка через SMB перемещает данные логирования и список процессов на шару;
  
  6. Парсинг событий для приведения к итоговому виду: Count – количество повторений, ID процесса(может быть пустым)";"Имя процесса(может быть пустым)";local=ip:порт remote=ip:порт.

Требования к выполнению:

  1. Запуск от АДМ у\з на всех собираемых серверах;
  
  2. Execution policy unrestricted;
  
  3. Сервера из списка не ниже 2012 R2;
  
  4. Invoke-command с сервера источника на сервера назначения выполняется успешно;
  
  5. SMB шара для raw data с серверов должна быть доступна для серверов из списка;
  
  6. Все папки для сбора данных должны быть созданы до начала выполнения скрипта(создавать директории он не умеет);
  
  7. На каждом из серверов на диске С: должно быть не менее 7 ГБ свободного места.

Баги:

  1. Operation cannot be carried out because an object already exists. - возникает на шаге создания сессии логирования;
  
  2. No MSFT_NetEventSession objects found with property 'Name' equal to $myFQDN" - если воспроизводится ошибка выше;
  
  3. Если у сервера =>2 ip - в папке result появляется пустой файл с выводом. Причина - скрипт не умеет работать с таким;
  
  4. Set-NetEventSession -MaxFileSize - увеличение параметра более 6ГБ вызывает ошибку(по крайней мере у меня вызывало).
